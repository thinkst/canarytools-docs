---
endpoints:
  disable:
    name: Disable Validation
    url: /api/v1/canarytokens/idp-app/validation/disable
    method: POST
    description: Disable the validation for a specific SAML IdP App token.
    params:
      - name: auth_token
        required: true
        type: string
        description: A valid auth token
      - name: canarytoken
        required: true
        type: string
        description: A valid Canarytoken
    response: A JSON structure with result indicator.
  enable:
    name: Enable Validation
    url: /api/v1/canarytokens/idp-app/validation/enable
    method: POST
    description: Enable the validation for a specific SAML IdP App token.
    params:
      - name: auth_token
        required: true
        type: string
        description: A valid auth token
      - name: canarytoken
        required: true
        type: string
        description: A valid Canarytoken
    response: A JSON structure with result indicator.
  save:
    name: Save Metadata
    url: /api/v1/canarytokens/idp-app/metadata/save
    method: POST
    description: Save a new validation metadata file for a specific SAML IdP App token.
    params:
      - name: auth_token
        required: true
        type: string
        description: A valid auth token
      - name: canarytoken
        required: true
        type: string
        description: A valid Canarytoken
      - name: metadata
        required: false
        type: string
        description: An XML file containing IdP metadata. Request must be multipart/form-data encoded if parameter is present.
    response: A JSON structure with result indicator.
---

# SAML IdP App Validation


<APIEndpoints :endpoints="$page.frontmatter.endpoints" :path="$page.regularPath">

::::: slot details

The SAML IdP App Canarytoken can optionally validate incoming requests using a metadata file generated by the IdP. These endpoints enable/disable this validation, and allow for uploading the metadata file.

:::::

</APIEndpoints>

## Disable Validation

<APIDetails :endpoint="$page.frontmatter.endpoints.disable">

::::: slot example

:::: tabs :options="{ useUrlFragment: false }"

::: tab "cURL"

``` bash
curl https://EXAMPLE.canary.tools/api/v1/canarytokens/idp-app/validation/disable \
  -d auth_token=EXAMPLE_AUTH_TOKEN \
  -d canarytoken=EXAMPLE_CANARYTOKEN
```

:::

::: tab "Python"

``` python
import requests

url = 'https://EXAMPLE.canary.tools/api/v1/canarytokens/idp-app/validation/disable'

payload = {
  'auth_token': 'EXAMPLE_AUTH_TOKEN',
  'canarytoken': 'EXAMPLE_CANARYTOKEN'
}

r = requests.post(url, data=payload)

print(r.json())
```

:::

::::


::: api-response
```json
{
  "result": "success"
}
```
:::

:::::

</APIDetails>

## Enable Validation

<APIDetails :endpoint="$page.frontmatter.endpoints.enable">

::::: slot example

:::: tabs :options="{ useUrlFragment: false }"

::: tab "cURL"

``` bash
curl https://EXAMPLE.canary.tools/api/v1/canarytokens/idp-app/validation/enable \
  -d auth_token=EXAMPLE_AUTH_TOKEN \
  -d canarytoken=EXAMPLE_CANARYTOKEN
```

:::

::: tab "Python"

``` python
import requests

url = 'https://EXAMPLE.canary.tools/api/v1/canarytokens/idp-app/validation/enable'

payload = {
  'auth_token': 'EXAMPLE_AUTH_TOKEN',
  'canarytoken': 'EXAMPLE_CANARYTOKEN'
}

r = requests.post(url, data=payload)

print(r.json())
```

:::

::::


::: api-response
```json
{
  "result": "success"
}
```
:::

:::::

</APIDetails>

## Save Metadata File

<APIDetails :endpoint="$page.frontmatter.endpoints.save">

::: slot optional-parameters-notes

::: tip
Sending through a request without `metadata` will delete the existing file.
:::

:::

::::: slot example

:::: tabs :options="{ useUrlFragment: false }"

::: tab "cURL"

``` bash
curl "https://EXAMPLE.canary.tools/api/v1/canarytokens/idp-app/metadata/save" \
  -X POST \
  -F auth_token=EXAMPLE_AUTH_TOKEN \
  -F canarytoken=EXAMPLE_CANARYTOKEN \
  -F metadata=@/path/to/metadata.xml
```

:::

::: tab "Python"

``` python
import requests

url = 'https://EXAMPLE.canary.tools/api/v1/canarytokens/idp-app/metadata/save'

payload = {
  'auth_token': 'EXAMPLE_AUTH_TOKEN',
  'canarytoken': 'EXAMPLE_CANARYTOKEN',
}

with open('metadata.xml', 'rb') as file:
    files = {'metadata': file}
    r = requests.post(url, files=files, data=payload)

print(r.json())
```

:::

::::


::: api-response
```json
{
  "metadata_entity_id": "<IdP entity ID>",
  "result": "success"
}
```
:::

:::::

</APIDetails>